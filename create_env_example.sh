#!/bin/bash

# Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚ .env.example Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ³Ð¾ .env Ñ„Ð°Ð¹Ð»Ð°.
# Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð² .env Ñ„Ð°Ð¹Ð»Ðµ:
# PARAMETER="some secret value" # example: "value"
# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ñ€Ð°ÑÐ¿Ð°Ñ€ÑÐ¸Ñ‚ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¹ Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ Ð¿Ð¾Ð´ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÑƒ

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð»Ð¸ .env Ñ„Ð°Ð¹Ð»
if [ ! -f ".env" ]; then
    echo "âŒ Ð¤Ð°Ð¹Ð» .env Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!"
    echo "Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» .env Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼Ð¸ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð¿ÐµÑ€ÐµÐ´ Ð·Ð°Ð¿ÑƒÑÐºÐ¾Ð¼ ÑÑ‚Ð¾Ð³Ð¾ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°."
    exit 1
fi

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ .env.example Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ .env
cp .env .env.example

# ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ ÐºÐ°Ð¶Ð´ÑƒÑŽ ÑÑ‚Ñ€Ð¾ÐºÑƒ
while IFS= read -r line; do
    # Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ ÑÑ‚Ñ€Ð¾ÐºÐ° Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ (ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ =)
    if [[ "$line" =~ ^[[:space:]]*[A-Z_][A-Z0-9_]*[[:space:]]*=[[:space:]]* ]]; then
        # Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ Ð¸Ð¼Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹
        var_name=$(echo "$line" | sed 's/^[[:space:]]*\([A-Z_][A-Z0-9_]*\)[[:space:]]*=.*/\1/')
        
        # Ð˜Ñ‰ÐµÐ¼ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð² ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ sed (ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ ÐºÐ°Ð²Ñ‹Ñ‡ÐºÐ¸)
        example=$(echo "$line" | sed -n 's/.*# example: *\([^[:space:]]*\)/\1/p')
        
        # Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ your_value
        if [ -z "$example" ]; then
            example="your_value"
        fi
        
        # Ð—Ð°Ð¼ÐµÐ½ÑÐµÐ¼ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð½Ð° Ð¿Ñ€Ð¸Ð¼ÐµÑ€
        echo "${var_name}=${example}" >> .env.example.tmp
    else
        # ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ð¸ Ð¿ÑƒÑÑ‚Ñ‹Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸ ÐºÐ°Ðº ÐµÑÑ‚ÑŒ
        echo "$line" >> .env.example.tmp
    fi
done < .env.example

# Ð—Ð°Ð¼ÐµÐ½ÑÐµÐ¼ Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»
mv .env.example.tmp .env.example

echo "âœ… Ð¤Ð°Ð¹Ð» .env.example ÑÐ¾Ð·Ð´Ð°Ð½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"
echo "ðŸ“ ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ñ‹ Ð¸Ð· ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÐµÐ²" 